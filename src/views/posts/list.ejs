<%- include('../partials/navbar') %>

<div class="container mt-4">
  <h1 class="mb-4">All Posts</h1>

  <!-- Flash messages -->
  <%- include('../partials/messages') %> <% if (posts.length === 0) { %>
  <div class="alert alert-info">No posts yet. Be the first to create one!</div>
  <% } else { %>
  <div class="row">
    <% posts.forEach(post => { %>
    <div class="col-md-6 mb-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title"><%= post.title %></h5>
          <p class="card-text">
            <%= post.content.length > 150 ? post.content.substring(0, 150) +
            "..." : post.content %>
          </p>
          <p class="card-text">
            <small class="text-muted">
              By <%= post.author ? post.author.username : "Unknown" %> on <%=
              post.createdAt.toLocaleDateString() %>
            </small>
          </p>

          <!-- Action buttons -->
          <a
            href="/posts/<%= post._id %>"
            class="btn btn-sm btn-outline-primary"
            >View</a
          >

          <% if (currentUser && post.author && currentUser._id.toString() ===
          post.author._id.toString()) { %>
          <a
            href="/posts/<%= post._id %>/edit"
            class="btn btn-sm btn-outline-secondary"
            >Edit</a
          >
          <form
            action="/posts/<%= post._id %>/delete"
            method="POST"
            class="d-inline"
          >
            <button type="submit" class="btn btn-sm btn-outline-danger">
              Delete
            </button>
          </form>
          <% } %>
        </div>
      </div>
    </div>
    <% }) %>
  </div>
  <% } %>
</div>
